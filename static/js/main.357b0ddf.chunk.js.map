{"version":3,"sources":["store/webgl/types.ts","store/webgl/reducers.ts","store/projections/types.ts","store/projections/reducers.ts","store/radon/actions.ts","store/radon/reducers.ts","store/reducer.ts","components/radon/scene.tsx","containers/radon.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["WebGLActionType","MutationActionType","initialState","context","undefined","payloadSetter","t","state","action","type","payload","anchor","SET_ANCHOR","originalRotation","SET_ORIGINAL_ROTATION","rotationDelta","SET_ROTATION_DELTA","combineReducers","rotation","ROTATE","MODIFY_ROTATION","add","valueOf","translation","TRANSLATE","scale","SCALE","MODIFY_SCALE","boxUpdate","x","updateBox","updateBeamBox","initialBoxState","matrix","initialBeamBoxState","radon","beamBox","box","rays","reducer","webgl","SET_CONTEXT","projections","v","y","z","Vector3","getRow","m","row","subset","index","toArray","BoxMesh","color","w","h","d","a","b","c","geometry","BoxGeometry","translate","rotateX","rotateY","rotateZ","Mesh","co","Color","MeshPhongMaterial","specular","addScalar","emissive","shininess","wireframe","side","DoubleSide","meshColor","Beams","bbox","params","geo","PlaneGeometry","mat","MeshBasicMaterial","transparent","opacity","map","RadonScene","children","webGLRenderer","camera","scene","this","WebGLRenderer","setSize","window","innerWidth","innerHeight","setPixelRatio","devicePixelRatio","Scene","PerspectiveCamera","position","light","DirectionalLight","set","normalize","OrbitControls","domElement","forEach","render","id","ref","appendChild","Radon","props","rs","bb","screen","tl","beamData","requestAnimationFrame","rotateBox","rotateBeamBox","TextureLoader","Math","PI","maxRayCount","ceil","log2","rayCount","pow","floor","numRays","beams","obj","N","canvas","document","createElement","height","width","getContext","imgData","createImageData","i","by","start","end","srcPos","destPos","intersections","Raycaster","sub","intersectObject","attStart","length","distance","j","data","putImageData","toDataURL","getBeamDataUrl","load","material","style","display","flexDirection","alignItems","padding","min","max","value","onChange","e","setRayCount","parseInt","target","Component","theta","connect","dispatch","n","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunk","App","Boolean","location","hostname","match","ReactDOM","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.357b0ddf.chunk.js","sourcesContent":["export type Mat4 = [\n    number, number, number, number,\n    number, number, number, number,\n    number, number, number, number,\n    number, number, number, number,\n];\n\nexport interface WebGLState {\n    context: WebGLRenderingContext | undefined;\n}\n\nexport enum WebGLActionType {\n    SET_CONTEXT = 'SET_CONTEXT'\n}\n\nexport interface SetWebGLContextAction {\n    type: WebGLActionType;\n    payload: WebGLRenderingContext;\n}\n\nexport type WebGLAction = SetWebGLContextAction","import {WebGLState, WebGLAction, WebGLActionType} from 'store/webgl/types'\n\nvar initialState: WebGLState = {\n    context: undefined,\n};\n\nexport default function reducer(\n    state = initialState,\n    action: WebGLAction\n): WebGLState {\n    if (action === undefined ) {\n        return state;\n    }\n\n    switch(action.type) {\n        case WebGLActionType.SET_CONTEXT:\n            return {context: action.payload};\n        default:\n            return state;\n    }\n}","import {Vec3} from 'store/types';\nexport interface MutationState {\n  rotation: Vec3;\n  translation: Vec3;\n  scale: Vec3;\n  rotationDelta: Vec3 | null;\n  originalRotation: Vec3 | null;\n  anchor: Vec3 | null;\n}\n\nexport enum MutationActionType {\n  ROTATE = 'ROTATE',\n  TRANSLATE = 'TRANSLATE',\n  SCALE = 'SCALE',\n  MODIFY_SCALE = 'MODIFY_SCALE',\n  MODIFY_ROTATION = 'MODIFY_ROTATION',\n  SET_ANCHOR = 'SET_ANCHOR',\n  SET_ORIGINAL_ROTATION = 'SET_ORIGINAL_ROTATION',\n  SET_ROTATION_DELTA = 'SET_ROTATION_DELTA',\n  CALC_ROT = 'CALC_ROT',\n}\n\nexport interface MutationAction {\n  type: MutationActionType;\n  payload: Vec3 | null;\n}\n","import {\n  MutationState,\n  MutationAction,\n  MutationActionType,\n} from 'store/projections/types';\nimport {Vec3} from 'store/types';\nimport {add} from 'mathjs';\nimport {combineReducers} from 'redux';\n\nfunction payloadSetter(t: MutationActionType) {\n  return function(state: Vec3 | undefined | null, action: MutationAction) {\n    if (state === undefined) return null;\n    if (action.type !== t) return state;\n    return action.payload;\n  };\n}\n\nconst anchor = payloadSetter(MutationActionType.SET_ANCHOR);\nconst originalRotation = payloadSetter(\n  MutationActionType.SET_ORIGINAL_ROTATION,\n);\nconst rotationDelta = payloadSetter(MutationActionType.SET_ROTATION_DELTA);\n\nfunction translation(\n  translation: Vec3 = [0, 0, 0],\n  action: MutationAction,\n): Vec3 {\n  if (action.type !== MutationActionType.TRANSLATE) return translation;\n\n  if (action.payload === null) return translation;\n\n  return action.payload;\n}\n\nfunction scale(scale: Vec3 = [1, 1, 1], action: MutationAction) {\n  if (!action.payload) return scale;\n\n  switch (action.type) {\n    case MutationActionType.SCALE:\n      return action.payload;\n    case MutationActionType.MODIFY_SCALE:\n      return add(scale, action.payload).valueOf() as Vec3;\n    default:\n      return scale;\n  }\n}\n\nfunction rotation(rotation: Vec3 = [0, 0, 0], action: MutationAction) {\n  if (!action.payload) return rotation;\n\n  switch (action.type) {\n    case MutationActionType.ROTATE:\n      return action.payload;\n    case MutationActionType.MODIFY_ROTATION:\n      return add(rotation, action.payload).valueOf() as Vec3;\n    default:\n      return rotation;\n  }\n}\n\nexport default combineReducers<MutationState, MutationAction>({\n  rotation,\n  translation,\n  scale,\n  anchor,\n  originalRotation,\n  rotationDelta,\n});\n","import {Matrix} from 'mathjs';\n\nexport const UPDATE_BOX = 'UPDATE_BOX';\nexport const UPDATE_BEAM_BOX = 'UPDATE_BEAM_BOX';\nexport const SET_RAY_COUNT = 'SET_RAY_COUNT';\n\nexport interface rayAction {\n  type: typeof SET_RAY_COUNT;\n  payload: number;\n}\n\nexport interface boxAction {\n  type: typeof UPDATE_BOX | typeof UPDATE_BEAM_BOX;\n  payload: Matrix;\n}\n\nexport type RadonAction = boxAction | rayAction;\n\nconst boxUpdate = (t: typeof UPDATE_BOX | typeof UPDATE_BEAM_BOX) => (\n  x: Matrix,\n) => ({\n  type: t,\n  payload: x,\n});\n\nexport const updateBox = boxUpdate(UPDATE_BOX);\nexport const updateBeamBox = boxUpdate(UPDATE_BEAM_BOX);\n\nexport const setRayCount = (n: number): rayAction => ({\n  type: SET_RAY_COUNT,\n  payload: n,\n});\n","import {add, Matrix, matrix} from 'mathjs';\nimport {combineReducers} from 'redux';\nimport {\n  boxAction,\n  rayAction,\n  UPDATE_BOX,\n  UPDATE_BEAM_BOX,\n  SET_RAY_COUNT,\n} from 'store/radon/actions';\n\nconst initialBoxState = matrix([[0, 0, 0], [32, 16, 8], [0, 0, 0]]);\n\nconst box = (state: Matrix | undefined, action: boxAction) => {\n  if (state === undefined) return initialBoxState;\n  return action.type === UPDATE_BOX\n    ? (add(action.payload, state) as Matrix)\n    : state;\n};\n\nconst rays = (state: number | undefined, action: rayAction) => {\n  if (state === undefined) return 7;\n  return action.type === SET_RAY_COUNT ? action.payload : state;\n};\n\nconst initialBeamBoxState = matrix([[-64, 0, 0], [128, 64, 4], [0, 0, 0]]);\n\nconst beamBox = (state: Matrix | undefined, action: boxAction) => {\n  if (state === undefined) return initialBeamBoxState;\n  return action.type === UPDATE_BEAM_BOX\n    ? (add(action.payload, state) as Matrix)\n    : state;\n};\n\nconst radon = combineReducers({\n  beamBox,\n  box,\n  rays,\n});\n\nexport default radon;\nexport type radonState = ReturnType<typeof radon>;\n","import webgl from 'store/webgl/reducers';\nimport {WebGLAction} from 'store/webgl/types';\nimport projections from 'store/projections/reducers';\nimport radon from 'store/radon/reducers';\nimport {RadonAction} from 'store/radon/actions';\nimport {MutationAction} from 'store/projections/types';\nimport {combineReducers} from 'redux';\n\nconst reducer = combineReducers({\n  webgl,\n  projections,\n  radon,\n});\n\nexport type ReduxState = ReturnType<typeof reducer>;\nexport type ReduxAction = WebGLAction | MutationAction | RadonAction;\nexport default reducer;\n","import React, {Component} from 'react';\nimport {Matrix, matrix, index} from 'mathjs';\n\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport {\n    Object3D,\n    Vector3,\n    Color,\n    MeshPhongMaterial,\n    DoubleSide,\n    BoxGeometry,\n    Mesh,\n    WebGLRenderer,\n    Camera,\n    Scene,\n    PerspectiveCamera,\n    DirectionalLight,\n    Raycaster,\n    TextureLoader,\n    Texture,\n    MeshBasicMaterial,\n    PlaneGeometry,\n    MeshBasicMaterialParameters,\n} from 'three';\n\n\nconst v = (x: number, y: number, z: number) => new Vector3(x, y, z)\n\n function meshColor(color: number) {\n     const co = () => new Color(color)\n     return new MeshPhongMaterial({\n         // light\n         specular: co(),\n         // intermediate\n         color: co().addScalar(-.3),\n         // dark\n         emissive: co().addScalar(-.8),\n         shininess: 50,\n         wireframe: false,\n         side: DoubleSide,\n         //map: ImageUtils.loadTexture('http://i.imgur.com/xCE2Br4.jpg?1')\n     });\n }\n\nfunction getRow(m: Matrix, row: number): number[] {\n    return (m.subset(index(row, [0, 1, 2])).toArray() as number[][])[0]\n}\n\nfunction BoxMesh(box: Matrix, color?: number) {\n    const [x, y, z] = getRow(box, 0)\n    const [w, h, d] = getRow(box, 1)\n    const [a, b, c] = getRow(box, 2)\n\n    var geometry = new BoxGeometry(w, h, d)\n\n    geometry.translate(x, y, z)\n    geometry.rotateX(a)\n    geometry.rotateY(b)\n    geometry.rotateZ(c)\n\n    return new Mesh(geometry, meshColor(color || 0xffffff))\n }\n\n\nfunction getBeamDataUrl(obj: Object3D, bbox: Matrix, N: number) {\n    const [x, y, z] = getRow(bbox, 0)\n    /* const y = getRow(bbox, 0)[1] */\n    const [w, h] = getRow(bbox, 1)\n\n    /* // Create canvas */\n    let canvas = document.createElement('canvas');\n    canvas.height = h;\n    canvas.width = w;\n\n    const context = canvas.getContext('2d');\n    if( context === null ) return;\n    const imgData = context.createImageData(w, h);\n\n    for( let i = 0; i < N; i++) {\n        const by = Math.floor(y+(i*(h/N))+h/(2*N))\n\n        const start = by*w*4\n        const end = start + w*4\n\n        const srcPos = v(x, (h/2)-by, z)\n        const destPos =  v(x + w, (h/2)-by, z)\n\n        const ray = new Raycaster(srcPos, destPos.sub(srcPos).normalize())\n        const intersections = ray.intersectObject(obj)\n\n        let opacity = 255\n        let attStart = end\n        let dist = 0\n        let att = 0\n        switch( intersections.length ) {\n            case 2:\n                dist = intersections[1].distance - intersections[0].distance\n                att = 1 - dist/40\n                opacity = att*255\n                attStart = intersections[1].distance\n                break;\n            case 4:\n                dist = intersections[2].distance - intersections[1].distance\n                att = 1 - dist/40\n                opacity = att*255\n                attStart = intersections[2].distance\n                break;\n        }\n\n        for (let j = start; j < end; j+=4) {\n            imgData.data[j] = 255\n            imgData.data[j+1] = 255\n            imgData.data[j+2] = 255\n            imgData.data[j+3] = (j-start)/4 >= attStart-2 ? opacity : 255\n        }\n\n    }\n\n    // put data to context at (0, 0)\n    context.putImageData(imgData, 0, 0);\n\n    return canvas.toDataURL()\n}\n\nconst Beams = (bbox: Matrix, params?: MeshBasicMaterialParameters) => {\n    /* const [x, y, z] = getRow(bbox, 0) */\n    const [w, h] = getRow(bbox, 1)\n    const geo = new PlaneGeometry(w, h)\n    /* geo.translate(x, y, z) */\n\n    const mat = new MeshBasicMaterial( params || {transparent: true, opacity: 0, map: null} );\n    return new Mesh(geo, mat)\n}\n\n\n/* function BeamBox(bbox: Matrix): Group { */\n/*     const [x, y, z] = getRow(bbox, 0) */\n/*     const [w, h, d] = getRow(bbox, 1) */\n/*     const [a, b, c] = getRow(bbox, 2) */\n/*  */\n/*     const g = new Group() */\n/*     const barW = w/100 */\n/*     const leftBar = BoxMesh(matrix([[x, y, z], [barW, h, d], [0, 0, 0]])) */\n/*     const rightBar = BoxMesh(matrix([[x + w, y, z], [barW, h, d], [0, 0, 0]])) */\n/*     const beams = Beams(bbox) */\n/*  */\n/*     leftBar.name = \"leftBar\" */\n/*     rightBar.name = \"rightBar\" */\n/*     beams.name = \"beams\" */\n/*  */\n/*     g.add(beams  as Object3D) */\n/*     g.add(leftBar) */\n/*     g.add(rightBar) */\n/*  */\n/*     g.rotateX(a) */\n/*     g.rotateY(b) */\n/*     g.rotateZ(c) */\n/*  */\n/*     return g */\n/* } */\n\nclass RadonScene {\n    webGLRenderer: WebGLRenderer\n    camera: Camera\n    scene: Scene\n\n    constructor(children: Array<Object3D | Mesh>) {\n        this.webGLRenderer = new WebGLRenderer()\n        this.webGLRenderer.setSize( window.innerWidth, window.innerHeight )\n        this.webGLRenderer.setPixelRatio( window.devicePixelRatio );\n\n        this.scene = new Scene()\n\n        this.camera = new PerspectiveCamera( 80, window.innerWidth / window.innerHeight, 0.1, 1000 )\n        this.camera.position.x = 0\n        this.camera.position.y = 0\n        this.camera.position.z = 100\n\n        var light = new DirectionalLight(0xfdfdfd, 2);\n        // you set the position of the light and it shines into the origin\n        light.position.set(2, 2, 1).normalize();\n        this.scene.add(light);\n        new OrbitControls(this.camera, this.webGLRenderer.domElement)\n\n        children.forEach(c => this.scene.add(c as Object3D));\n    }\n\n    render() {\n        this.webGLRenderer.render(this.scene, this.camera)\n        return (<div id=\"scene-container\" ref={d => d ? d.appendChild(this.webGLRenderer.domElement) : \"\"}></div>)\n    }\n}\n\ninterface RadonProps {\n    box: Matrix;\n    beamBox: Matrix;\n    numRays: number;\n    rotateBox: (r: number) => void;\n    rotateBeamBox: (r: number) => void;\n    setRayCount: (n: number) => void\n}\n\nexport default class Radon extends Component<RadonProps> {\n    rs: RadonScene\n    b: Object3D\n    bb: Object3D\n    screen: Object3D\n    tl: TextureLoader\n    beamData: string\n\n    constructor(props: RadonProps) {\n        super(props)\n\n        const rotateBox = () => {\n            this.props.rotateBeamBox(.01)\n            requestAnimationFrame(rotateBox)\n        }\n        requestAnimationFrame(rotateBox)\n\n        this.beamData = ''\n        this.tl = new TextureLoader()\n        this.b = BoxMesh(this.props.box, 0x0000ff)\n        this.bb = Beams(this.props.beamBox)\n\n        const [x, y, z] = getRow(this.props.beamBox, 0)\n        const [w, h, d] = getRow(this.props.beamBox, 1)\n\n        this.screen = Beams(matrix([[x+w, y, z],[w,h,d],[0,-Math.PI,0]]), {transparent: false, color: 0xffffff})\n        this.rs = new RadonScene([\n            this.b,\n            this.bb,\n        ])\n    }\n\n    render() {\n        /* this.bb.rotateZ(.01) */\n        this.b.rotateZ(.01)\n\n        const h = getRow(this.props.beamBox, 1)[1]\n        const maxRayCount = Math.ceil(Math.log2(h))\n        const rayCount = Math.pow(2, Math.floor(this.props.numRays))\n\n        const beams = (this.bb as Mesh)\n        const beamData = getBeamDataUrl(this.b, this.props.beamBox, rayCount)\n\n        // only create new beam image if beams have been updated\n        if( beamData && beamData !== this.beamData ) {\n            this.tl.load(beamData, (t: Texture) => {\n                beams.material = new MeshBasicMaterial({map: t, transparent: true})\n            })\n            this.beamData = beamData\n        }\n\n        return (\n            <div>\n                <div id='controls' style={{position: 'absolute', display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '16px'}}>\n                    <h1 style={{color: 'white'}} >{rayCount} Beam{rayCount > 1 ? 's' : ''}</h1>\n                    <input type='range' min={0} max={maxRayCount} value={this.props.numRays} onChange={e => this.props.setRayCount(parseInt(e.target.value))} />\n                </div>\n                {this.rs.render()}\n            </div>)\n    }\n}\n","import {connect} from 'react-redux';\nimport {matrix} from 'mathjs';\nimport {ReduxState} from 'store/reducer';\nimport {\n  updateBox,\n  updateBeamBox,\n  setRayCount,\n  RadonAction,\n} from 'store/radon/actions';\nimport RadonScene from 'components/radon/scene';\n\nconst rotateX = (theta: number) =>\n  matrix([[0, 0, 0], [0, 0, 0], [theta, 0, 0]]);\n\nconst mapState = (state: ReduxState) => ({\n  box: state.radon.box,\n  beamBox: state.radon.beamBox,\n  numRays: state.radon.rays,\n});\n\nconst mapDispatch = (dispatch: (action: RadonAction) => void) => ({\n  rotateBox: (theta: number) => dispatch(updateBox(rotateX(theta))),\n  rotateBeamBox: (theta: number) => dispatch(updateBeamBox(rotateX(theta))),\n  setRayCount: (n: number) => dispatch(setRayCount(n)),\n});\n\nexport default connect(\n  mapState,\n  mapDispatch,\n)(RadonScene);\n","import React from 'react';\nimport './App.css';\nimport reducer from 'store/reducer';\nimport {createStore, applyMiddleware, compose} from 'redux';\nimport {Provider} from 'react-redux';\nimport thunk from 'redux-thunk'\nimport RadonScene from 'containers/radon';\n// import ConfigPanel from 'containers/mutations/config-panel';\n// import ShaderCanvas from 'containers/canvas/shader-canvas'\n\nconst composeEnhancers = (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\nconst store = createStore(reducer, composeEnhancers(\n  applyMiddleware(thunk),\n))\n\n/* <ConfigPanel />\n<ShaderCanvas /> */\n\nconst App: React.FC = () => {\n  return (\n    <Provider store={store}>\n      <RadonScene />\n    </Provider>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}